# playbooks/lab2/error-handling-playbook.yml
---
- name: Playbook with error handling
  hosts: managed_nodes
  become: yes
  gather_facts: yes

  tasks:
    - name: Attempt to install a package that might fail
      yum:
        name: non-existent-package
        state: present
      ignore_errors: yes
      register: package_result

    - name: Display error message if package installation failed
      debug:
        msg: "Package installation failed: {{ package_result.msg }}"
      when: package_result.failed

    - name: Continue with other tasks regardless of previous failure
      file:
        path: /tmp/ansible-lab2-test
        state: touch
        mode: '0644'

    - name: Use block/rescue for complex error handling
      block:
        - name: Try to start a service that might not exist
          service:
            name: non-existent-service
            state: started
      rescue:
        - name: Handle the error gracefully
          debug:
            msg: "Service start failed, but we're handling it gracefully"
      always:
        - name: This always runs
          debug:
            msg: "This task always executes"
