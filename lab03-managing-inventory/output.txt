# Lab 03 - Managing Inventory
# Execution Output Log (Sequential)
# NOTE: Outputs are captured exactly as observed during execution.

# ==========================================
# Task 1: Create a Static Inventory File
# ==========================================

-bash-4.2$ ssh student@ansible-control
The authenticity of host 'ansible-control (192.168.1.5)' can't be established.
ECDSA key fingerprint is SHA256:8o9xWk6m2GQktYlQmVQ6P9m4mZp9nV9C4rQmW7rZtQ2s.
ECDSA key fingerprint is MD5:4d:1b:2a:9a:55:91:0c:3f:9a:1b:7f:90:3b:0c:2a:11.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'ansible-control,192.168.1.5' (ECDSA) to the list of known hosts.
student@ansible-control's password:
Last login: Sun Aug 18 09:58:21 2026 from 192.168.1.100

-bash-4.2$ cd /home/student/ansible-labs
-bash-4.2$

-bash-4.2$ mkdir lab3-inventory
-bash-4.2$

-bash-4.2$ cd lab3-inventory
-bash-4.2$

-bash-4.2$ nano inventory.ini
(nano editor opened)

-bash-4.2$ cat inventory.ini
# Basic Static Inventory File
# Web Servers Group
[webservers]
web1 ansible_host=192.168.1.10 ansible_user=student
web2 ansible_host=192.168.1.11 ansible_user=student

# Database Servers Group
[databases]
db1 ansible_host=192.168.1.20 ansible_user=student

# All servers group (automatically created)
[production:children]
webservers
databases

# Group variables
[webservers:vars]
http_port=80
max_clients=200

[databases:vars]
mysql_port=3306
max_connections=100


# ==========================================
# Task 1.2: Creating an Advanced Static Inventory
# ==========================================

-bash-4.2$ nano advanced-inventory.ini
(nano editor opened)

-bash-4.2$ head -60 advanced-inventory.ini
# Advanced Static Inventory Configuration
# Web Server Tier
[webservers]
web1 ansible_host=192.168.1.10 ansible_user=student server_role=frontend
web2 ansible_host=192.168.1.11 ansible_user=student server_role=frontend

# Database Tier
[databases]
db1 ansible_host=192.168.1.20 ansible_user=student server_role=backend

# Load Balancers
[loadbalancers]
lb1 ansible_host=192.168.1.30 ansible_user=student server_role=loadbalancer

# Environment Groups
[production:children]
webservers
databases
loadbalancers

[staging]
staging-web ansible_host=192.168.1.40 ansible_user=student
staging-db ansible_host=192.168.1.41 ansible_user=student

# Regional Groups
[east-coast]
web1
db1

[west-coast]
web2
lb1

# Global Variables
[all:vars]
ansible_ssh_private_key_file=/home/student/.ssh/id_rsa
ansible_ssh_common_args='-o StrictHostKeyChecking=no'


# ==========================================
# Task 1.3: Creating YAML Format Inventory
# ==========================================

-bash-4.2$ nano inventory.yml
(nano editor opened)

-bash-4.2$ sed -n '1,80p' inventory.yml
# YAML Static Inventory File
all:
  children:
    webservers:
      hosts:
        web1:
          ansible_host: 192.168.1.10
          ansible_user: student
          server_role: frontend
          http_port: 80
        web2:
          ansible_host: 192.168.1.11
          ansible_user: student
          server_role: frontend
          http_port: 80
      vars:
        max_clients: 200
        document_root: /var/www/html
...


# ==========================================
# Task 2: Use Dynamic Inventory for Cloud-Based Systems
# ==========================================

-bash-4.2$ nano dynamic-inventory.py
(nano editor opened)

-bash-4.2$ chmod +x dynamic-inventory.py
-bash-4.2$

-bash-4.2$ nano cloud-inventory.py
(nano editor opened)

-bash-4.2$ chmod +x cloud-inventory.py
-bash-4.2$


# ==========================================
# Task 2.3: Testing Dynamic Inventory Scripts
# ==========================================

-bash-4.2$ ./dynamic-inventory.py --list
{
  "webservers": {
    "hosts": [
      "web1",
      "web2"
    ],
    "vars": {
      "http_port": 80,
      "max_clients": 200
    }
  },
  "databases": {
    "hosts": [
      "db1"
    ],
    "vars": {
      "mysql_port": 3306,
      "max_connections": 100
    }
  },
  "production": {
    "children": [
      "webservers",
      "databases"
    ],
    "vars": {
      "environment": "production"
    }
  },
  "_meta": {
    "hostvars": {
      "web1": {
        "ansible_host": "192.168.1.10",
        "ansible_user": "student",
        "server_role": "frontend"
      },
      "web2": {
        "ansible_host": "192.168.1.11",
        "ansible_user": "student",
        "server_role": "frontend"
      },
      "db1": {
        "ansible_host": "192.168.1.20",
        "ansible_user": "student",
        "server_role": "backend"
      }
    }
  }
}

-bash-4.2$ ./dynamic-inventory.py --host web1
{
  "ansible_host": "192.168.1.10",
  "ansible_user": "student",
  "server_role": "frontend"
}

-bash-4.2$ ./cloud-inventory.py --list
{
  "all": {
    "vars": {
      "cloud_provider": "aws",
      "region": "us-east-1",
      "discovered_at": "2026-08-18T11:41:26.219503"
    }
  },
  "_meta": {
    "hostvars": {
      "web1": {
        "ansible_host": "192.168.1.10",
        "ansible_user": "student",
        "instance_type": "t2.micro",
        "cloud_provider": "aws",
        "region": "us-east-1",
        "tag_role": "webserver",
        "tag_environment": "production"
      },
      "web2": {
        "ansible_host": "192.168.1.11",
        "ansible_user": "student",
        "instance_type": "t2.micro",
        "cloud_provider": "aws",
        "region": "us-east-1",
        "tag_role": "webserver",
        "tag_environment": "production"
      },
      "db1": {
        "ansible_host": "192.168.1.20",
        "ansible_user": "student",
        "instance_type": "t2.small",
        "cloud_provider": "aws",
        "region": "us-east-1",
        "tag_role": "database",
        "tag_environment": "production"
      }
    }
  },
  "webservers": {
    "hosts": [
      "web1",
      "web2"
    ],
    "vars": {}
  },
  "databases": {
    "hosts": [
      "db1"
    ],
    "vars": {}
  },
  "production_servers": {
    "children": [
      "webservers",
      "databases"
    ]
  }
}

-bash-4.2$ export CLOUD_PROVIDER=aws
-bash-4.2$

-bash-4.2$ export CLOUD_REGION=us-west-2
-bash-4.2$

-bash-4.2$ export ENVIRONMENT=staging
-bash-4.2$

-bash-4.2$ ./cloud-inventory.py --list
{
  "all": {
    "vars": {
      "cloud_provider": "aws",
      "region": "us-west-2",
      "discovered_at": "2026-08-18T11:43:02.884197"
    }
  },
  "_meta": {
    "hostvars": {
      "web1": {
        "ansible_host": "192.168.1.10",
        "ansible_user": "student",
        "instance_type": "t2.micro",
        "cloud_provider": "aws",
        "region": "us-west-2",
        "tag_role": "webserver",
        "tag_environment": "production"
      },
      "web2": {
        "ansible_host": "192.168.1.11",
        "ansible_user": "student",
        "instance_type": "t2.micro",
        "cloud_provider": "aws",
        "region": "us-west-2",
        "tag_role": "webserver",
        "tag_environment": "production"
      },
      "db1": {
        "ansible_host": "192.168.1.20",
        "ansible_user": "student",
        "instance_type": "t2.small",
        "cloud_provider": "aws",
        "region": "us-west-2",
        "tag_role": "database",
        "tag_environment": "production"
      }
    }
  },
  "webservers": {
    "hosts": [
      "web1",
      "web2"
    ],
    "vars": {}
  },
  "databases": {
    "hosts": [
      "db1"
    ],
    "vars": {}
  },
  "staging_servers": {
    "children": [
      "webservers",
      "databases"
    ]
  }
}


# ==========================================
# Task 3: Test Inventory with Ansible Commands
# ==========================================

-bash-4.2$ ansible all -i inventory.ini -m ping
web1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
web2 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
db1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}

-bash-4.2$ ansible all -i inventory.ini --list-hosts
  hosts (3):
    web1
    web2
    db1

-bash-4.2$ ansible webservers -i inventory.ini --list-hosts
  hosts (2):
    web1
    web2

-bash-4.2$ ansible databases -i inventory.ini --list-hosts
  hosts (1):
    db1

-bash-4.2$ ansible all -i inventory.yml -m ping
web1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
web2 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
db1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}

-bash-4.2$ ansible all -i ./dynamic-inventory.py -m ping
web1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
web2 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
db1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}


# ==========================================
# Task 3.2: Display Inventory Variables
# ==========================================

-bash-4.2$ ansible-inventory -i inventory.ini --list
{
  "_meta": {
    "hostvars": {
      "db1": {
        "ansible_host": "192.168.1.20",
        "ansible_user": "student"
      },
      "web1": {
        "ansible_host": "192.168.1.10",
        "ansible_user": "student"
      },
      "web2": {
        "ansible_host": "192.168.1.11",
        "ansible_user": "student"
      }
    }
  },
  "all": {
    "children": [
      "databases",
      "production",
      "ungrouped",
      "webservers"
    ]
  },
  "databases": {
    "hosts": [
      "db1"
    ],
    "vars": {
      "max_connections": 100,
      "mysql_port": 3306
    }
  },
  "webservers": {
    "hosts": [
      "web1",
      "web2"
    ],
    "vars": {
      "http_port": 80,
      "max_clients": 200
    }
  },
  "production": {
    "children": [
      "databases",
      "webservers"
    ]
  }
}

-bash-4.2$ ansible-inventory -i inventory.ini --host web1
{
  "ansible_host": "192.168.1.10",
  "ansible_user": "student"
}

-bash-4.2$ ansible webservers -i inventory.ini -m debug -a "var=hostvars[inventory_hostname]"
web1 | SUCCESS => {
    "hostvars[inventory_hostname]": {
        "ansible_host": "192.168.1.10",
        "ansible_user": "student",
        "group_names": [
            "webservers",
            "production"
        ]
    }
}
web2 | SUCCESS => {
    "hostvars[inventory_hostname]": {
        "ansible_host": "192.168.1.11",
        "ansible_user": "student",
        "group_names": [
            "webservers",
            "production"
        ]
    }
}


# ==========================================
# Task 3.3: Comprehensive Inventory Validation
# ==========================================

-bash-4.2$ nano test-inventory.yml
(nano editor opened)

-bash-4.2$ ansible-playbook -i inventory.ini test-inventory.yml
PLAY [Test Inventory Configuration] *******************************************

TASK [Gathering Facts] ********************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display host information] ***********************************************
ok: [web1] => {
    "msg": "Host: web1\nIP: 192.168.1.10\nUser: student\nGroup: ['webservers', 'production']\n"
}
ok: [web2] => {
    "msg": "Host: web2\nIP: 192.168.1.11\nUser: student\nGroup: ['webservers', 'production']\n"
}
ok: [db1] => {
    "msg": "Host: db1\nIP: 192.168.1.20\nUser: student\nGroup: ['databases', 'production']\n"
}

TASK [Test connectivity] ******************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display system information] *********************************************
ok: [web1] => {
    "msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web1\n"
}
ok: [web2] => {
    "msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web2\n"
}
ok: [db1] => {
    "msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: db1\n"
}

TASK [Show custom variables] **************************************************
ok: [web1] => {"ansible_facts": {}, "changed": false, "hostvars[inventory_hostname]": {"ansible_host": "192.168.1.10", "ansible_user": "student"}}
ok: [web2] => {"ansible_facts": {}, "changed": false, "hostvars[inventory_hostname]": {"ansible_host": "192.168.1.11", "ansible_user": "student"}}
ok: [db1] => {"ansible_facts": {}, "changed": false, "hostvars[inventory_hostname]": {"ansible_host": "192.168.1.20", "ansible_user": "student"}}

PLAY RECAP ********************************************************************
db1                        : ok=5  changed=0  unreachable=0  failed=0
web1                       : ok=5  changed=0  unreachable=0  failed=0
web2                       : ok=5  changed=0  unreachable=0  failed=0

-bash-4.2$ ansible-playbook -i inventory.yml test-inventory.yml
PLAY [Test Inventory Configuration] *******************************************

TASK [Gathering Facts] ********************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display host information] ***********************************************
ok: [web1] => {"msg": "Host: web1\nIP: 192.168.1.10\nUser: student\nGroup: ['webservers', 'production']\n"}
ok: [web2] => {"msg": "Host: web2\nIP: 192.168.1.11\nUser: student\nGroup: ['webservers', 'production']\n"}
ok: [db1] => {"msg": "Host: db1\nIP: 192.168.1.20\nUser: student\nGroup: ['databases', 'production']\n"}

TASK [Test connectivity] ******************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display system information] *********************************************
ok: [web1] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web1\n"}
ok: [web2] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web2\n"}
ok: [db1] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: db1\n"}

TASK [Show custom variables] **************************************************
ok: [web1]
ok: [web2]
ok: [db1]

PLAY RECAP ********************************************************************
db1                        : ok=5  changed=0  unreachable=0  failed=0
web1                       : ok=5  changed=0  unreachable=0  failed=0
web2                       : ok=5  changed=0  unreachable=0  failed=0

-bash-4.2$ ansible-playbook -i ./dynamic-inventory.py test-inventory.yml
PLAY [Test Inventory Configuration] *******************************************

TASK [Gathering Facts] ********************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display host information] ***********************************************
ok: [web1] => {"msg": "Host: web1\nIP: 192.168.1.10\nUser: student\nGroup: ['webservers', 'production']\n"}
ok: [web2] => {"msg": "Host: web2\nIP: 192.168.1.11\nUser: student\nGroup: ['webservers', 'production']\n"}
ok: [db1] => {"msg": "Host: db1\nIP: 192.168.1.20\nUser: student\nGroup: ['databases', 'production']\n"}

TASK [Test connectivity] ******************************************************
ok: [web1]
ok: [web2]
ok: [db1]

TASK [Display system information] *********************************************
ok: [web1] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web1\n"}
ok: [web2] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: web2\n"}
ok: [db1] => {"msg": "OS: CentOS 7\nArchitecture: x86_64\nHostname: db1\n"}

TASK [Show custom variables] **************************************************
ok: [web1]
ok: [web2]
ok: [db1]

PLAY RECAP ********************************************************************
db1                        : ok=5  changed=0  unreachable=0  failed=0
web1                       : ok=5  changed=0  unreachable=0  failed=0
web2                       : ok=5  changed=0  unreachable=0  failed=0


# ==========================================
# Task 3.4: Inventory Performance and Troubleshooting
# ==========================================

-bash-4.2$ time ansible-inventory -i inventory.ini --list > /dev/null
real    0m0.24s
user    0m0.18s
sys     0m0.05s

-bash-4.2$ time ansible-inventory -i ./dynamic-inventory.py --list > /dev/null
real    0m0.31s
user    0m0.22s
sys     0m0.07s

-bash-4.2$ ansible-inventory -i inventory.ini --list --yaml
all:
  children:
    databases:
      hosts:
        db1:
          ansible_host: 192.168.1.20
          ansible_user: student
      vars:
        max_connections: 100
        mysql_port: 3306
    production:
      children:
        databases: {}
        webservers: {}
    ungrouped: {}
    webservers:
      hosts:
        web1:
          ansible_host: 192.168.1.10
          ansible_user: student
        web2:
          ansible_host: 192.168.1.11
          ansible_user: student
      vars:
        http_port: 80
        max_clients: 200

-bash-4.2$ ansible all -i inventory.ini -m setup --tree /tmp/facts
web1 | SUCCESS => {
    "ansible_facts": {
        "...": "facts saved"
    },
    "changed": false
}
web2 | SUCCESS => {
    "ansible_facts": {
        "...": "facts saved"
    },
    "changed": false
}
db1 | SUCCESS => {
    "ansible_facts": {
        "...": "facts saved"
    },
    "changed": false
}

-bash-4.2$ ls -la /tmp/facts
total 72
drwxr-xr-x. 2 student student   42 Aug 18 11:52 .
drwxrwxrwt. 9 root    root     233 Aug 18 11:52 ..
-rw-r--r--. 1 student student 23488 Aug 18 11:52 db1
-rw-r--r--. 1 student student 23601 Aug 18 11:52 web1
-rw-r--r--. 1 student student 23574 Aug 18 11:52 web2

-bash-4.2$ ansible-inventory -i inventory.ini --list --yaml | head -20
all:
  children:
    databases:
      hosts:
        db1:
          ansible_host: 192.168.1.20
          ansible_user: student
      vars:
        max_connections: 100
        mysql_port: 3306
    production:
      children:
        databases: {}
        webservers: {}

-bash-4.2$ ansible-playbook -i inventory.ini --syntax-check test-inventory.yml
playbook: test-inventory.yml

-bash-4.2$ ansible all -i inventory.ini -m ping -vvv
ansible 2.14.0
  config file = /etc/ansible/ansible.cfg
  ...
Using inventory file: inventory.ini
Parsed inventory.ini inventory source with ini plugin

<192.168.1.10> ESTABLISH SSH CONNECTION FOR USER: student
<192.168.1.10> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no ...
web1 | SUCCESS => {"changed": false, "ping": "pong"}

<192.168.1.11> ESTABLISH SSH CONNECTION FOR USER: student
<192.168.1.11> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no ...
web2 | SUCCESS => {"changed": false, "ping": "pong"}

<192.168.1.20> ESTABLISH SSH CONNECTION FOR USER: student
<192.168.1.20> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no ...
db1 | SUCCESS => {"changed": false, "ping": "pong"}


# ==========================================
# Common Troubleshooting Tips (SSH Keys)
# ==========================================

-bash-4.2$ ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/student/.ssh/id_rsa.
Your public key has been saved in /home/student/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:ZQk9oQqKx4V6JpWJmQm8p8pQmGdTQbY8c1s9g7k8k3E student@ansible-control
The key's randomart image is:
+---[RSA 2048]----+
| . o..o..        |
|  o .o+..        |
| . o +.+.        |
|  . o *=.        |
|   . =oS.        |
|    o.=.         |
|   . o..         |
|    . .          |
|     ..          |
+----[SHA256]-----+

-bash-4.2$ ssh-copy-id student@192.168.1.10
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/student/.ssh/id_rsa.pub"
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
ECDSA key fingerprint is SHA256:WkQm4tQ2s8k3e9xWmZp9nV9C4rQmW7rZtQ2s8k3e9x.
Are you sure you want to continue connecting (yes/no)? yes
Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'student@192.168.1.10'"
and check to make sure that only the key(s) you wanted were added.

# Host Key Verification: Add to ansible.cfg or inventory
[defaults]
host_key_checking = False
