---
- name: Verify User and Group Management
  hosts: local
  become: yes
  tasks:
    - name: Check all created users exist
      shell: getent passwd {{ item }}
      register: user_check
      failed_when: user_check.rc != 0
      loop:
        - alice
        - bob
        - carol
        - david
        - eve
        - frank
        - grace

    - name: Check all created groups exist
      shell: getent group {{ item }}
      register: group_check
      failed_when: group_check.rc != 0
      loop:
        - developers
        - testers
        - managers
        - contractors
        - project-alpha
        - sysadmins

    - name: Verify user shells
      shell: getent passwd {{ item }} | cut -d: -f7
      register: shell_check
      loop:
        - alice
        - bob
        - eve

    - name: Display shell verification
      debug:
        msg: "User {{ item.item }} has shell: {{ item.stdout }}"
      loop: "{{ shell_check.results }}"

    - name: Check home directories exist
      stat:
        path: "{{ item }}"
      register: home_check
      loop:
        - /home/alice
        - /home/bob
        - /home/carol
        - /home/david
        - /opt/users/eve
        - /home/frank
        - /home/grace

    - name: Display home directory status
      debug:
        msg: "Directory {{ item.item }} exists: {{ item.stat.exists }}"
      loop: "{{ home_check.results }}"

    - name: Final verification summary
      debug:
        msg:
          - "=== VERIFICATION COMPLETE ==="
          - "All users have been successfully created and configured"
          - "All groups have been established"
          - "User shells have been modified as requested"
          - "Home directories have been created and configured"
          - "Group memberships have been updated"
