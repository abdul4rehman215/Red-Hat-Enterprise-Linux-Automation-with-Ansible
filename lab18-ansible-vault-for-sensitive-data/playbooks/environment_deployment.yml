---
- name: Environment-Specific Deployment
  hosts: "{{ target_environment | default('development') }}"
  gather_facts: yes

  tasks:
    - name: Display environment information
      debug:
        msg: |
          Deploying to: {{ environment }}
          Database Host: {{ database_host }}
          API Endpoint: {{ api_endpoint }}
          Debug Mode: {{ debug_enabled }}

    - name: Create environment-specific configuration
      template:
        src: ../templates/app_config.j2
        dest: "/tmp/{{ environment }}_config.conf"
        mode: '0600'
      become: yes

    - name: Verify sensitive variables are loaded
      debug:
        msg: "Database password is configured (length: {{ vault_database_password | length }})"
      when: vault_database_password is defined
