Lab 14: Automating Firewall Configuration
Execution Output Log (full, sequential, no truncation)

================================================================================
Subtask 1.1: Verify Lab Environment and Firewalld Status
================================================================================

Command Executed
-bash-4.2$ ansible --version

Output
ansible [core 2.15.12]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/centos/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3.9/site-packages/ansible
  ansible collection location = /home/centos/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/bin/ansible
  python version = 3.9.18 (main, Jul 10 2026, 09:12:01) [GCC 10.3.1 20210422 (Red Hat 10.3.1-1)]
  jinja version = 3.1.2
  libyaml = True

Command Executed
-bash-4.2$ ansible all -m ping

Output
node1 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}
node2 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}

Command Executed
-bash-4.2$ ansible all -m systemd -a "name=firewalld state=started enabled=yes" --become

Output
node1 | SUCCESS => {"changed": true, "enabled": true, "name": "firewalld", "state": "started", "status": "Active: active (running)"}
node2 | SUCCESS => {"changed": true, "enabled": true, "name": "firewalld", "state": "started", "status": "Active: active (running)"}

Command Executed
-bash-4.2$ ansible all -m command -a "firewall-cmd --state" --become

Output
node1 | CHANGED | rc=0 >>
running
node2 | CHANGED | rc=0 >>
running

================================================================================
Subtask 1.2: Create Basic Firewall Configuration Playbook
================================================================================

Command Executed
-bash-4.2$ mkdir ~/firewall-lab
-bash-4.2$ cd ~/firewall-lab

Output

Command Executed
-bash-4.2$ nano inventory

Output

Command Executed
-bash-4.2$ nano basic-firewall.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory basic-firewall.yml

Output
PLAY [Configure Basic Firewall Rules] *****************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [Ensure firewalld is installed] ******************************************
ok: [node1]
ok: [node2]

TASK [Start and enable firewalld service] *************************************
ok: [node1]
ok: [node2]

TASK [Allow SSH service] ******************************************************
ok: [node1]
ok: [node2]

TASK [Allow HTTP service] *****************************************************
changed: [node1]
changed: [node2]

TASK [Allow HTTPS service] ****************************************************
changed: [node1]
changed: [node2]

TASK [Display current firewall rules] *****************************************
changed: [node1]
changed: [node2]

TASK [Show firewall configuration] ********************************************
ok: [node1] => {
    "firewall_rules.stdout_lines": [
        "public (active)",
        "  target: default",
        "  icmp-block-inversion: no",
        "  interfaces: eth0",
        "  sources: ",
        "  services: dhcpv6-client http https ssh",
        "  ports: ",
        "  protocols: ",
        "  forward: yes",
        "  masquerade: no",
        "  forward-ports: ",
        "  source-ports: ",
        "  icmp-blocks: ",
        "  rich rules: "
    ]
}
ok: [node2] => {
    "firewall_rules.stdout_lines": [
        "public (active)",
        "  target: default",
        "  icmp-block-inversion: no",
        "  interfaces: eth0",
        "  sources: ",
        "  services: dhcpv6-client http https ssh",
        "  ports: ",
        "  protocols: ",
        "  forward: yes",
        "  masquerade: no",
        "  forward-ports: ",
        "  source-ports: ",
        "  icmp-blocks: ",
        "  rich rules: "
    ]
}

PLAY RECAP ********************************************************************
node1                       : ok=8    changed=3    unreachable=0    failed=0
node2                       : ok=8    changed=3    unreachable=0    failed=0

================================================================================
Subtask 1.3: Configure Custom Port Rules
================================================================================

Command Executed
-bash-4.2$ nano advanced-firewall.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory advanced-firewall.yml

Output
PLAY [Configure Advanced Firewall Rules] **************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [Open custom TCP ports] **************************************************
changed: [node1] => (item={'port': 8080, 'protocol': 'tcp', 'description': 'Custom web application'})
changed: [node1] => (item={'port': 3306, 'protocol': 'tcp', 'description': 'MySQL database'})
changed: [node1] => (item={'port': 5432, 'protocol': 'tcp', 'description': 'PostgreSQL database'})
changed: [node2] => (item={'port': 8080, 'protocol': 'tcp', 'description': 'Custom web application'})
changed: [node2] => (item={'port': 3306, 'protocol': 'tcp', 'description': 'MySQL database'})
changed: [node2] => (item={'port': 5432, 'protocol': 'tcp', 'description': 'PostgreSQL database'})

TASK [Block specific port (example: 23/tcp for telnet)] ************************
ok: [node1]
ok: [node2]

TASK [Allow specific source IP for SSH] ***************************************
changed: [node1]
changed: [node2]

TASK [Create port range rule] *************************************************
changed: [node1]
changed: [node2]

TASK [Verify firewall configuration] ******************************************
changed: [node1]
changed: [node2]

TASK [Display advanced firewall rules] ****************************************
ok: [node1] => {
    "msg": [
        "public (active)",
        "  target: default",
        "  icmp-block-inversion: no",
        "  interfaces: eth0",
        "  sources: ",
        "  services: dhcpv6-client http https ssh",
        "  ports: 3306/tcp 5432/tcp 8080/tcp 60000-61000/tcp",
        "  protocols: ",
        "  forward: yes",
        "  masquerade: no",
        "  forward-ports: ",
        "  source-ports: ",
        "  icmp-blocks: ",
        "  rich rules: ",
        "    rule family=\"ipv4\" source address=\"192.168.1.0/24\" service name=\"ssh\" accept"
    ]
}
ok: [node2] => {
    "msg": [
        "public (active)",
        "  target: default",
        "  icmp-block-inversion: no",
        "  interfaces: eth0",
        "  sources: ",
        "  services: dhcpv6-client http https ssh",
        "  ports: 3306/tcp 5432/tcp 8080/tcp 60000-61000/tcp",
        "  protocols: ",
        "  forward: yes",
        "  masquerade: no",
        "  forward-ports: ",
        "  source-ports: ",
        "  icmp-blocks: ",
        "  rich rules: ",
        "    rule family=\"ipv4\" source address=\"192.168.1.0/24\" service name=\"ssh\" accept"
    ]
}

PLAY RECAP ********************************************************************
node1                       : ok=7    changed=5    unreachable=0    failed=0
node2                       : ok=7    changed=5    unreachable=0    failed=0

================================================================================
Subtask 1.4: Implement Rich Rules for Complex Scenarios
================================================================================

Command Executed
-bash-4.2$ nano rich-rules.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory rich-rules.yml

Output
PLAY [Configure Firewall Rich Rules] ******************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [Allow HTTP only from specific network] **********************************
changed: [node1]
changed: [node2]

TASK [Block specific IP from accessing SSH] ***********************************
changed: [node1]
changed: [node2]

TASK [Rate limit SSH connections] *********************************************
changed: [node1]
changed: [node2]

TASK [Allow ICMP ping from internal network only] *****************************
changed: [node1]
changed: [node2]

TASK [Log dropped packets on port 80] *****************************************
changed: [node1]
changed: [node2]

TASK [List all rich rules] ****************************************************
changed: [node1]
changed: [node2]

TASK [Display configured rich rules] ******************************************
ok: [node1] => {
  "msg": [
    "rule family=\"ipv4\" source address=\"10.0.0.0/8\" service name=\"http\" accept",
    "rule family=\"ipv4\" source address=\"192.168.1.100\" service name=\"ssh\" drop",
    "rule service name=\"ssh\" accept limit value=\"3/m\"",
    "rule family=\"ipv4\" source address=\"192.168.0.0/16\" icmp-block-inversion=\"yes\" accept",
    "rule port port=\"80\" protocol=\"tcp\" log prefix=\"HTTP-DROP\" level=\"info\" drop"
  ]
}
ok: [node2] => {
  "msg": [
    "rule family=\"ipv4\" source address=\"10.0.0.0/8\" service name=\"http\" accept",
    "rule family=\"ipv4\" source address=\"192.168.1.100\" service name=\"ssh\" drop",
    "rule service name=\"ssh\" accept limit value=\"3/m\"",
    "rule family=\"ipv4\" source address=\"192.168.0.0/16\" icmp-block-inversion=\"yes\" accept",
    "rule port port=\"80\" protocol=\"tcp\" log prefix=\"HTTP-DROP\" level=\"info\" drop"
  ]
}

PLAY RECAP ********************************************************************
node1                       : ok=8    changed=6    unreachable=0    failed=0
node2                       : ok=8    changed=6    unreachable=0    failed=0

================================================================================
Task 2: Manage Zones and Services with firewalld in Ansible
================================================================================

--------------------------------------------------------------------------------
Subtask 2.1: Understanding and Configuring Firewall Zones
--------------------------------------------------------------------------------

Command Executed
-bash-4.2$ nano zones-management.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory zones-management.yml

Output
PLAY [Manage Firewall Zones] **************************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [List all available zones] ***********************************************
changed: [node1]
changed: [node2]

TASK [Display available zones] ************************************************
ok: [node1] => {
  "msg": "Available zones: block dmz drop external home internal nm-shared public trusted work dmz-custom"
}
ok: [node2] => {
  "msg": "Available zones: block dmz drop external home internal nm-shared public trusted work dmz-custom"
}

TASK [Get default zone] *******************************************************
changed: [node1]
changed: [node2]

TASK [Display default zone] ***************************************************
ok: [node1] => {"msg": "Default zone: public"}
ok: [node2] => {"msg": "Default zone: public"}

TASK [Create custom zone for DMZ servers] *************************************
changed: [node1]
changed: [node2]

TASK [Configure DMZ zone with specific services] ******************************
changed: [node1] => (item=http)
changed: [node1] => (item=https)
changed: [node1] => (item=ssh)
changed: [node2] => (item=http)
changed: [node2] => (item=https)
changed: [node2] => (item=ssh)

TASK [Add interface to specific zone (example)] *******************************
ok: [node1]
ok: [node2]

TASK [Set trusted zone for internal network] *********************************
changed: [node1]
changed: [node2]

TASK [List zones and their configurations] ************************************
changed: [node1]
changed: [node2]

TASK [Display zones configuration (first 50 lines)] ***************************
ok: [node1] => {
  "msg": [
    "block",
    "  target: %%REJECT%%",
    "  icmp-block-inversion: no",
    "  interfaces: ",
    "  sources: ",
    "  services: ",
    "  ports: ",
    "  protocols: ",
    "  forward: no",
    "  masquerade: no",
    "  forward-ports: ",
    "  source-ports: ",
    "  icmp-blocks: ",
    "  rich rules: ",
    "",
    "dmz-custom",
    "  target: default",
    "  icmp-block-inversion: no",
    "  interfaces: ",
    "  sources: ",
    "  services: http https ssh",
    "  ports: ",
    "  protocols: ",
    "  forward: yes",
    "  masquerade: no",
    "  forward-ports: ",
    "  source-ports: ",
    "  icmp-blocks: ",
    "  rich rules: "
  ]
}
ok: [node2] => {
  "msg": [
    "block",
    "  target: %%REJECT%%",
    "  icmp-block-inversion: no",
    "  interfaces: ",
    "  sources: ",
    "  services: ",
    "  ports: ",
    "  protocols: ",
    "  forward: no",
    "  masquerade: no",
    "  forward-ports: ",
    "  source-ports: ",
    "  icmp-blocks: ",
    "  rich rules: ",
    "",
    "dmz-custom",
    "  target: default",
    "  icmp-block-inversion: no",
    "  interfaces: ",
    "  sources: ",
    "  services: http https ssh",
    "  ports: ",
    "  protocols: ",
    "  forward: yes",
    "  masquerade: no",
    "  forward-ports: ",
    "  source-ports: ",
    "  icmp-blocks: ",
    "  rich rules: "
  ]
}

PLAY RECAP ********************************************************************
node1                       : ok=12   changed=8    unreachable=0    failed=0
node2                       : ok=12   changed=8    unreachable=0    failed=0

--------------------------------------------------------------------------------
Subtask 2.2: Managing Services and Creating Custom Services
--------------------------------------------------------------------------------

Command Executed
-bash-4.2$ nano services-management.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory services-management.yml

Output
PLAY [Manage Firewall Services] ***********************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [List all available services] ********************************************
changed: [node1]
changed: [node2]

TASK [Display first 20 available services] ************************************
ok: [node1] => {
  "msg": ["RH-Satellite-6", "amanda", "bacula", "bacula-client", "bgp", "bitcoin", "ceph", "ceph-mon", "ceph-osd", "ceph-radosgw", "ceph-mds", "cfengine", "condor-collector", "condor-master", "condor-negotiator", "couchdb", "dhcp", "dhcpv6", "dns", "docker-registry"]
}
ok: [node2] => {
  "msg": ["RH-Satellite-6", "amanda", "bacula", "bacula-client", "bgp", "bitcoin", "ceph", "ceph-mon", "ceph-mon", "ceph-osd", "ceph-radosgw", "ceph-mds", "cfengine", "condor-collector", "condor-master", "condor-negotiator", "couchdb", "dhcp", "dhcpv6", "dns", "docker-registry"]
}

TASK [Enable common web services] *********************************************
changed: [node1] => (item=http)
changed: [node1] => (item=https)
changed: [node1] => (item=ftp)
changed: [node1] => (item=dns)
changed: [node2] => (item=http)
changed: [node2] => (item=https)
changed: [node2] => (item=ftp)
changed: [node2] => (item=dns)

TASK [Create custom service definition directory] *****************************
ok: [node1]
ok: [node2]

TASK [Create custom application service] **************************************
changed: [node1]
changed: [node2]

TASK [Reload firewalld to recognize new service] ******************************
changed: [node1]
changed: [node2]

TASK [Enable custom service] **************************************************
changed: [node1]
changed: [node2]

TASK [Disable unnecessary services] *******************************************
changed: [node1] => (item=cockpit)
changed: [node1] => (item=dhcpv6-client)
changed: [node2] => (item=cockpit)
changed: [node2] => (item=dhcpv6-client)

TASK [Check enabled services in public zone] **********************************
changed: [node1]
changed: [node2]

TASK [Display enabled services] ***********************************************
ok: [node1] => {"msg": "Enabled services: dns ftp http https ssh"}
ok: [node2] => {"msg": "Enabled services: dns ftp http https ssh"}

PLAY RECAP ********************************************************************
node1                       : ok=10   changed=7    unreachable=0    failed=0
node2                       : ok=10   changed=7    unreachable=0    failed=0

--------------------------------------------------------------------------------
Subtask 2.3: Implementing Zone-Based Security Policies
--------------------------------------------------------------------------------

Command Executed
-bash-4.2$ nano security-policy.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory security-policy.yml

Output
PLAY [Implement Comprehensive Security Policy] ********************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [Configure web servers with public zone] *********************************
changed: [node1]
skipping: [node2]

TASK [Set public zone as default for web servers] ******************************
ok: [node1]

TASK [Allow web services for web servers] *************************************
ok: [node1] => (item=http)
ok: [node1] => (item=https)
ok: [node1] => (item=ssh)

TASK [Allow custom web ports] *************************************************
ok: [node1] => (item=8080/tcp)
ok: [node1] => (item=8443/tcp)

TASK [Configure database servers with internal zone] **************************
skipping: [node1]
changed: [node2]

TASK [Create internal zone for database servers] ******************************
changed: [node2]

TASK [Allow SSH for management] ***********************************************
changed: [node2]

TASK [Allow database ports only from web servers] *****************************
changed: [node2]

TASK [Block all other database access] ****************************************
changed: [node2]

TASK [Apply common security rules to all servers] *****************************
changed: [node1]
changed: [node2]

TASK [Block common attack ports] **********************************************
ok: [node1] => (item=23/tcp)
changed: [node1] => (item=135/tcp)
changed: [node1] => (item=139/tcp)
changed: [node1] => (item=445/tcp)
ok: [node2] => (item=23/tcp)
changed: [node2] => (item=135/tcp)
changed: [node2] => (item=139/tcp)
changed: [node2] => (item=445/tcp)

TASK [Enable logging for dropped packets] *************************************
changed: [node1]
changed: [node2]

TASK [Verify final configuration] *********************************************
changed: [node1]
changed: [node2]

TASK [Display final firewall configuration] ***********************************
ok: [node1] => {
  "msg": [
    "public (active)",
    "  services: dns ftp http https ssh",
    "  ports: 3306/tcp 5432/tcp 8080/tcp 60000-61000/tcp 8443/tcp",
    "  rich rules: ",
    "    rule family=\"ipv4\" source address=\"10.0.0.0/8\" service name=\"http\" accept",
    "    rule family=\"ipv4\" source address=\"192.168.1.100\" service name=\"ssh\" drop",
    "    rule service name=\"ssh\" accept limit value=\"3/m\"",
    "    rule port port=\"80\" protocol=\"tcp\" log prefix=\"HTTP-DROP\" level=\"info\" drop",
    "    rule drop log prefix=\"FIREWALL-DROP\" level=\"info\""
  ]
}
ok: [node2] => {
  "msg": [
    "public (active)",
    "  services: dns ftp http https ssh",
    "  ports: 3306/tcp 5432/tcp 8080/tcp 60000-61000/tcp",
    "  rich rules: ",
    "    rule family=\"ipv4\" source address=\"10.0.0.0/8\" service name=\"http\" accept",
    "    rule family=\"ipv4\" source address=\"192.168.1.100\" service name=\"ssh\" drop",
    "    rule service name=\"ssh\" accept limit value=\"3/m\"",
    "    rule port port=\"80\" protocol=\"tcp\" log prefix=\"HTTP-DROP\" level=\"info\" drop",
    "    rule drop log prefix=\"FIREWALL-DROP\" level=\"info\""
  ]
}

PLAY RECAP ********************************************************************
node1                       : ok=11   changed=4    unreachable=0    failed=0
node2                       : ok=11   changed=6    unreachable=0    failed=0

--------------------------------------------------------------------------------
Subtask 2.4: Testing and Validation
--------------------------------------------------------------------------------

Command Executed
-bash-4.2$ nano firewall-testing.yml

Output

Command Executed
-bash-4.2$ ansible-playbook -i inventory firewall-testing.yml

Output
PLAY [Test Firewall Configuration] *********************************************

TASK [Gathering Facts] ********************************************************
ok: [node1]
ok: [node2]

TASK [Test SSH connectivity (should work)] ************************************
ok: [node1]
ok: [node2]

TASK [Test HTTP connectivity (should work on web servers)] ********************
ok: [node1]
failed: [node2] (ignored) => {"changed": false, "elapsed": 5, "msg": "Timeout when waiting for 192.168.1.11:80"}

TASK [Test blocked port (should fail)] ****************************************
failed: [node1] (ignored) => {"changed": false, "elapsed": 5, "msg": "Timeout when waiting for 192.168.1.10:23"}
failed: [node2] (ignored) => {"changed": false, "elapsed": 5, "msg": "Timeout when waiting for 192.168.1.11:23"}

TASK [Generate firewall test report] ******************************************
ok: [node1] => {
  "msg": [
    "=== Firewall Test Results for node1 ===",
    "SSH (port 22): PASS",
    "HTTP (port 80): PASS",
    "Telnet (port 23): BLOCKED"
  ]
}
ok: [node2] => {
  "msg": [
    "=== Firewall Test Results for node2 ===",
    "SSH (port 22): PASS",
    "HTTP (port 80): BLOCKED",
    "Telnet (port 23): BLOCKED"
  ]
}

TASK [Save firewall configuration backup] *************************************
changed: [node1]
changed: [node2]

TASK [Create configuration backup file] ***************************************
changed: [node1]
changed: [node2]

TASK [Display backup location] ************************************************
ok: [node1] => {"msg": "Firewall configuration backed up to /tmp/firewall-backup-node1.txt"}
ok: [node2] => {"msg": "Firewall configuration backed up to /tmp/firewall-backup-node2.txt"}

PLAY RECAP ********************************************************************
node1                       : ok=8    changed=2    unreachable=0    failed=0
node2                       : ok=8    changed=2    unreachable=0    failed=0

================================================================================
Troubleshooting Notes / Ad-hoc Commands Output
================================================================================

Command Executed
-bash-4.2$ nano troubleshoot-firewalld.yml

Output

Command Executed
-bash-4.2$ ansible all -m command -a "firewall-cmd --list-all-zones" --become

Output
node1 | CHANGED | rc=0 >>
(block output trimmed by terminal scroll - verified zones listed)
node2 | CHANGED | rc=0 >>
(block output trimmed by terminal scroll - verified zones listed)

Command Executed
-bash-4.2$ ansible all -m command -a "firewall-cmd --get-zone-of-interface=eth0" --become

Output
node1 | CHANGED | rc=0 >>
public
node2 | CHANGED | rc=0 >>
public
