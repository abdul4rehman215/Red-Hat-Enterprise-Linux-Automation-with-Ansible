global
 daemon
 chroot /var/lib/haproxy
 stats socket /run/haproxy/admin.sock mode 660 level admin
 stats timeout 30s
 user haproxy
 group haproxy

defaults
 mode http
 timeout connect 5000ms
 timeout client 50000ms
 timeout server 50000ms
 option httplog
 option dontlognull

frontend webapp_frontend
 bind *:80
 default_backend webapp_servers

backend webapp_servers
 balance roundrobin
 option httpchk GET /webapp/
{% for server in backend_servers %}
 server {{ hostvars[server]['ansible_hostname'] }} {{ hostvars[server]['ansible_default_ipv4']['address'] }}:80 check
{% endfor %}

listen stats
 bind *:8404
 stats enable
 stats uri /stats
 stats refresh 30s
 stats admin if TRUE
